<!DOCTYPE html>
<html lang="en">
<head>
  <title>CMD COMBINER</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <script src="https://code.jquery.com/jquery-3.3.0.min.js" integrity="sha256-RTQy8VOmNlT6b2PIRur37p6JEBZUE7o8wPgMvu18MC4=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <style>
        .br1 {
            font-family: 'Anton', sans-serif;
        }
        nav ul a, nav .brand-logo {
            color: #444;
        }
        body {
            background: url(cinematic.jpg) no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }
    </style>


<script>

    function copyToClipboard(elementId) {
            var aux = document.createElement("input");
            aux.setAttribute("value", document.getElementById(elementId).value);
            document.body.appendChild(aux);
            aux.select();
            document.execCommand("copy");
            document.body.removeChild(aux);
    }
</script>


</head>
<body>
    <div class="navbar">
            <nav>
                <div class="nav-wrapper blue lighten-4">
                    <a href="index.html" class="brand-logo br1" style="margin-left: 10px;"><em><strong>CMD HUB</strong></em></a>
                    <ul class="right">
                        <li><a href="index.html">Home</a></li>
                    </ul>
                </div>
            </nav>
    </div>


    <div class="container" style="margin-top: 100px;">
            <div class="card horizontal">
              <div class="card-stacked">
                <div class="card-content">


                     <h4 class="center-align">Command Combiner</h4>
                     <br>
                     <p class="center-align">Enter in commands. Get a machine. Not sure how to use this? Check our <a href="usecmd.html" target="_blank">usage page</a></p>
                     <br>
                    <div class="row">
                            <form class="col s12">
                              <div class="row">
                                <div class="input-field col s12">
                                  <textarea id="textarea1" class="txtarea1" style="height: 1000px;"></textarea>
                                  <label for="textarea1">Textarea</label>
                                </div>
                              </div>
                            </form>
                          </div>
                                
                    <div class="center-align">
                            <br>
                            <a class="waves-effect waves-light btn btn-large indigo lighten-2 reesmee" style="width: calc(70% + 32px);">Submit</a>
                     </div>
                    </div>
                 </div>
            </div>
    </div>

    <script>
        let preset;
        var totalcmd;
        var typemap;
        var newl;
        var zspan = 0; 
            $('.reesmee').click(function() {
                typemap = [];
                totalcmd = 'summon falling_block ~ ~1 ~ {Block:stone,Time:1,Passengers:[{id:falling_block,Block:redstone_block,Time:1,Passengers:[{id:falling_block,Block:activator_rail,Time:1,Passengers:[{id:commandblock_minecart,Command:"gamerule commandBlockOutput false"},'
                newl = $(".txtarea1").val().split(/\n/gi);
                zspan = 0;
                parseCMD();
            });

            function parseCMD() {
                var templist = [];
                var initials = [];
                let extras;
                var condi; // lets make an example. suppose newl has 1 item in its array: N:setblock ~ ~ ~ command_block 0 0 {Command:"tellraw @a \"\\u00a7cnested\""}
                for(x = 0; x < newl.length; x++) {
                    templist = [];
                    condi = 0;
                    if (newl[x] == "") { // nope
                        continue;
                    } else if (newl[x] == "++z++") {
                        templist[0] = "++z++";
                        typemap.push(templist);
                        continue;
                        // preset tests begin below
                    } else if (newl[x].slice(0,6).toLowerCase() == 'queue[' && newl[x].indexOf(']') >= 0) {
                        console.log('enter a preset chain');
                        preset = newl[x].indexOf("]");
                        extras = newl[x].slice(6, preset).split(/,/gi);
                        var btemp = ['queue', 'Game Name', 'q1', 'green', 2, 20, 'false', 'tqnk', 'actionbar', 'f1', 1, 'default'];
                        for(var ext = 0; ext < extras.length; ext++) {
                            if(extras[ext].toLowerCase().indexOf('objective:') >= 0) {
                                let anobj = extras[ext].replace(/objective:/gi , '');
                                anobj = anobj.trim();
                                btemp[0] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('game:') >= 0) {
                                let anobj = extras[ext].replace(/game:/gi, '');
                                anobj = anobj.trim();
                                btemp[1] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('team:') >= 0) {
                                let anobj = extras[ext].replace(/team:/gi, '');
                                anobj = anobj.trim();
                                btemp[2] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('color:') >= 0) {
                                let anobj = extras[ext].replace(/color:/gi, '');
                                anobj = anobj.trim();
                                btemp[3] = anobj.toString().toLowerCase();
                            } else if(extras[ext].toLowerCase().indexOf('min:') >= 0) {
                                let anobj = extras[ext].replace(/min:/gi, '');
                                anobj = anobj.trim();
                                btemp[4] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('time:') >= 0) {
                                let anobj = extras[ext].replace(/time:/gi, '');
                                anobj = anobj.trim();
                                btemp[5] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('override:') >= 0) {
                                let anobj = extras[ext].replace(/override:/gi, '');
                                anobj = anobj.trim();
                                btemp[6] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('type:') >= 0) {
                                let anobj = extras[ext].replace(/type:/gi, '');
                                anobj = anobj.trim();
                                btemp[7] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('display:') >= 0) {
                                let anobj = extras[ext].replace(/display:/gi, '');
                                anobj = anobj.trim();
                                btemp[8] = anobj.toString().toLowerCase();
                            } else if(extras[ext].toLowerCase().indexOf('function:') >= 0) {
                                let anobj = extras[ext].replace(/function:/gi, '');
                                anobj = anobj.trim();
                                btemp[9] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('per:') >= 0) {
                                let anobj = extras[ext].replace(/per:/gi, '');
                                anobj = anobj.trim();
                                btemp[10] = anobj.toString();
                            } else if(extras[ext].toLowerCase().indexOf('default:') >= 0) {
                                let anobj = extras[ext].replace(/default:/gi, '');
                                anobj = anobj.trim();
                                btemp[11] = anobj.toString();
                            };
                        };
                        console.log(btemp);
                        var randtag = Math.floor(Math.random() * 10000);
                        console.log(randtag);
                        //var btemp = ['queue', 'Game Name', 'q1', 'green', 2, 20, 'false', 'tqnk', 'actionbar', 'f1', 1, 'default'];
                        let typedisp;
                        if(btemp[8] == 'tellraw') {
                            typedisp = 'tellraw @a'
                        } else {
                            typedisp = 'title @a actionbar'
                        }
                        var finalq = [
                            ['r', `tellraw @a[score_${btemp[0]}_min=1,team=!${btemp[2]}] \\\\\\"\\\\\\\\u00a77You have \\\\\\\\u00a7ajoined the queue \\\\\\\\u00a77for \\\\\\\\u00a7e${btemp[1]}!\\\\\\"`],
                            ['c', `execute @a[score_${btemp[0]}_min=1,team=!${btemp[2]}] ~ ~ ~ playsound block.note.flute master @s ~ ~ ~ 1000 0.6`],
                            ['c', `scoreboard players tag @a[score_${btemp[0]}_min=1,team=!${btemp[2]}] add ${randtag}a`],
                            ['c', `scoreboard teams join ${btemp[2]} @a[tag=${randtag}a]`],
                            ['c', `scoreboard players reset @a[tag=${randtag}a] ${btemp[0]}`],
                            ['c', `scoreboard players tag @a[tag=${randtag}a] remove ${randtag}a`],
                            ['c', `tellraw @a[score_${btemp[0]}_min=1,team=${btemp[2]}] \\\\\\"\\\\\\\\u00a77You have \\\\\\\\u00a7cleft the queue \\\\\\\\u00a77for \\\\\\\\u00a7e${btemp[1]}!\\\\\\"`],
                            ['c', `execute @a[score_${btemp[0]}_min=1,team=${btemp[2]}] ~ ~ ~ playsound block.note.flute master @s ~ ~ ~ 1000 0.4`],
                            ['c', `scoreboard players tag @a[score_${btemp[0]}_min=1,team=${btemp[2]}] add ${randtag}b`],
                            ['c', `scoreboard teams join ${btemp[11]} @a[tag=${randtag}b]`],
                            ['c', `scoreboard players reset @a[tag=${randtag}b] ${btemp[0]}`],
                            ['c', `scoreboard players tag @a[tag=${randtag}b] remove ${randtag}b`],
                            ['r', `scoreboard teams join ${btemp[11]} @a[team=]`],
                            ['++z++'],
                            ['r', `stats block ~ ~1 ~ set SuccessCount *q ${btemp[9]}`],
                            ['r', `testfor @a[team=${btemp[2]}]`],
                            ['r', `scoreboard players test *q ${btemp[9]} ${btemp[4]}`],
                            ['cc', `scoreboard players test *g ${btemp[9]} 0 0`],
                            ['cc', `scoreboard players set *g ${btemp[9]} 1`],
                            ['cc', `blockdata ~ ~1 ~ {auto:1}`],
                            ['i', 'blockdata ~ ~ ~ {auto:0}'],
                            ['c', `scoreboard players set *t ${btemp[9]} 1`],
                            ['c', `scoreboard players set *se ${btemp[9]} ${btemp[5]}`],
                            ['c', `scoreboard players set *se2 ${btemp[9]} 0`],
                            ['c', `${typedisp} \\\\\\"\\\\\\\\u00a7e${btemp[1]} \\\\\\\\u00a77will begin in \\\\\\\\u00a7a${btemp[5]} seconds!\\\\\\"`],
                            ['c', `execute @a ~ ~ ~ playsound entity.wither.spawn master @s ~ ~ ~ 10000 0.1`],
                            ['++z++'],
                            ['r', `scoreboard players test *t ${btemp[9]} 1`],
                            ['cc', `scoreboard players add *t ${btemp[9]} 1`],
                            ['r', `scoreboard players test *t ${btemp[9]} 21`],
                            ['cc', `scoreboard players set *t ${btemp[9]} 1`],
                            ['cc', `scoreboard players add *se2 ${btemp[9]} 1`],
                            ['cc', `scoreboard players remove *se ${btemp[9]} 1`],
                            ['cc', `blockdata ~ ~1 ~ {auto:1}`],
                            ['i', `blockdata ~ ~ ~ {auto:0}`],
                            ['c', `scoreboard players test *se2 ${btemp[9]} ${btemp[10]}`],
                            ['cc', `scoreboard players test *se ${btemp[9]} 1`],
                            ['cc', `scoreboard players set *se2 ${btemp[9]} 0`],
                            ['cc', `${typedisp} [\\\\\\"\\\\\\",{\\\\\\"text\\\\\\":\\\\\\"\\\\\\\\u00a7e${btemp[1]} \\\\\\\\u00a77will begin in \\\\\\"},{\\\\\\"score\\\\\\":{\\\\\\"objective\\\\\\":\\\\\\"${btemp[9]}\\\\\\",\\\\\\"name\\\\\\":\\\\\\"*se\\\\\\"},\\\\\\"color\\\\\\":\\\\\\"green\\\\\\"}]`],
                            ['cc', `execute @a ~ ~ ~ playsound ui.button.click master @s ~ ~ ~ 1000 1`],
                            ['c', `scoreboard players test *se ${btemp[9]} 0 0`],
                            ['cc', `scoreboard players test *q ${btemp[9]} 0 ${btemp[4] - 1}`],
                            ['cc', `scoreboard players set *t ${btemp[9]} 0`],
                            ['cc', `scoreboard players set *g ${btemp[9]} 0`],
                            ['cc', `tellraw @a \\\\\\"\\\\\\\\u00a78\\\\\\\\u00bb \\\\\\\\u00a7cNot enough players!\\\\\\"`],
                            ['cc', `execute @a ~ ~ ~ playsound entity.villager.no master @s ~ ~ ~ 1000 1`],
                            ['c', `scoreboard players test *se ${btemp[9]} 0 0`],
                            ['cc', `scoreboard players test *q ${btemp[9]} ${btemp[4]}`],
                            ['cc', `scoreboard players set *t ${btemp[9]} 0`],
                            ['cc', `scoreboard players set *g ${btemp[9]} 2`],
                            ['cc', `blockdata ~ ~1 ~ {auto:1}`],
                            ['i', `blockdata ~ ~ ~ {auto:0}`],
                            ['c', `tellraw @a \\\\\\"\\\\\\\\u00a7e${btemp[1]} \\\\\\\\u00a77will now begin!\\\\\\"`],
                            ['c', `execute @a ~ ~ ~ playsound entity.player.levelup master @s ~ ~ ~ 1000 0.1`]
                        ];
                        //var btemp = ['queue', 'Game Name', 'q1', 'green', 2, 20, 'false', 'tqnk', 'actionbar', 'f1', 1, 'default'];
                        var finalint = [
                            `scoreboard objectives add ${btemp[0]} dummy`,
                            `scoreboard teams add ${btemp[2]}`,
                            `scoreboard teams option ${btemp[2]} color ${btemp[3]}`,
                            `scoreboard teams option ${btemp[2]} collisionRule never`,
                            `scoreboard teams option ${btemp[2]} friendlyfire false`,
                            `scoreboard objectives add ${btemp[9]} dummy`,
                            `scoreboard players add *q ${btemp[9]} 0`,
                            `scoreboard players add *g ${btemp[9]} 0`,
                            `scoreboard teams add ${btemp[11]}`,
                            `scoreboard teams option ${btemp[11]} color gray`,
                            `scoreboard teams option ${btemp[11]} collisionRule never`,
                            `scoreboard teams option ${btemp[11]} friendlyfire false`
                        ];
                        for(var btempa = 0; btempa < finalq.length; btempa++) {
                            console.log(finalq[btempa][0]);
                            console.log(finalq[btempa][1]);
                            typemap.push(finalq[btempa]);
                        };
                        for(var btempb = 0; btempb < finalint.length; btempb++) {
                            console.log(finalint[btempb]);
                            initials.push(finalint[btempb]);
                        };
                        continue;
                    } else if (newl[x].slice(0,6).toLowerCase() == 'respawn[' && newl[x].indexOf(']') >= 0) {
                        console.log('faggot');
                    };  
                    var scmd = "zxy";
                    switch (newl[x].substring(0,2)) {
                            case "R:": 
                                scmd = "r";
                                break;
                            case "C:":
                                scmd = "c";
                                break;
                            case "I:":
                                scmd = "i";
                                break;
                            case "N:": //N case found
                                scmd = "n";
                    }
                    if (scmd == "zxy") {
                        condi = 1;
                        switch (newl[x].substring(0,3)) {
                            case "RC:":
                                scmd = "rc";
                                break;
                            case "CC:":
                                scmd = "cc";
                                break;
                            case "IC:":
                                scmd = "ic";
                                break;
                            default:
                                scmd = "ch";
                        }
                    };
                    var rawcmd;
                    if (scmd != "ch" && condi == 0) {
                        rawcmd = newl[x].substring(2); // Sets actual command to rawcmd
                    } else if (scmd != "ch" && condi == 1) {
                        rawcmd = newl[x].substring(3);
                    } else {
                        scmd = "c";
                        rawcmd = newl[x];
                    }
                    if (scmd == "n") { //This Code block is activated
                        rawcmd = rawcmd.replace(/\\\\\\\\\\\\\\"/g, '!@#!SMEE_15_!@#!'); 
                        rawcmd = rawcmd.replace(/\\\\\\"/g, '!@#!SMEE_7_!@#!');
                        rawcmd = rawcmd.replace(/\\"/g, '!@#!SMEE_3_!@#!'); //Activated as query finds the result. Replaces the innermost one (one with 1 backslash) With SMEECODE3
                        rawcmd = rawcmd.replace(/"/g, '!@#!SMEE_1_!@#!'); //Same as above, however, it applies to the outer ones now. SMEE CODE 1.

                        


                        rawcmd = rawcmd.replace(/\\\\\\\\/g, '!@#!SMREE_8_!@#!');
                        rawcmd = rawcmd.replace(/\\\\/g, '!@#!SMREE_4_!@#!'); // \u00a7 handling. Works on the fragile basis that the only quotes left are part of these special chars. Finds double backslash. Replaces with SMREE code 4.
                        rawcmd = rawcmd.replace(/\\/g, '!@#!SMREE_2_!@#!');
                        
                        rawcmd = rawcmd.replace(/!@#!SMEE_15_!@#!/g, '\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"');
                        rawcmd = rawcmd.replace(/!@#!SMEE_7_!@#!/g, '\\\\\\\\\\\\\\"');
                        rawcmd = rawcmd.replace(/!@#!SMEE_3_!@#!/g, '\\\\\\"');
                        rawcmd = rawcmd.replace(/!@#!SMEE_1_!@#!/g, '\\"');
                        
                        
                        rawcmd = rawcmd.replace(/!@#!SMREE_8_!@#!/g, '\\\\\\\\\\\\\\\\');
                        rawcmd = rawcmd.replace(/!@#!SMREE_4_!@#!/g, '\\\\\\\\');
                        rawcmd = rawcmd.replace(/!@#!SMREE_2_!@#!/g, '\\\\'); //Backslash appropriations terminate. Each backslash level tiers up by 1. Final raw command: setblock ~ ~ ~ command_block 0 0 {Command:\"tellraw @a \\\"\\\\u00a7cnested\\\"\"}
                        rawcmd = rawcmd.trim();
                        
                        initials.push(rawcmd); // Adds rawcmd to the initials array
                    } else {
                        rawcmd = rawcmd.replace(/\\\\\\\\\\\\\\"/g, '!@#!SMEE_31_!@#!');
                        rawcmd = rawcmd.replace(/\\\\\\"/g, '!@#!SMEE_15_!@#!');
                        rawcmd = rawcmd.replace(/\\"/g, '!@#!SMEE_7_!@#!');
                        rawcmd = rawcmd.replace(/"/g, '!@#!SMEE_3_!@#!');
                        

                        rawcmd = rawcmd.replace(/\\\\\\\\/g, '!@#!SMREE_16_!@#!');
                        rawcmd = rawcmd.replace(/\\\\/g, '!@#!SMREE_8_!@#!');
                        rawcmd = rawcmd.replace(/\\/g, '!@#!SMREE_4_!@#!');

                        rawcmd = rawcmd.replace(/!@#!SMREE_16_!@#!/g, '\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\');
                        rawcmd = rawcmd.replace(/!@#!SMREE_8_!@#!/g, '\\\\\\\\\\\\\\\\');
                        rawcmd = rawcmd.replace(/!@#!SMREE_4_!@#!/g, '\\\\\\\\');
                        
                        
                        rawcmd = rawcmd.replace(/!@#!SMEE_31_!@#!/g, '\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"');
                        rawcmd = rawcmd.replace(/!@#!SMEE_15_!@#!/g, '\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\"');
                        rawcmd = rawcmd.replace(/!@#!SMEE_7_!@#!/g, '\\\\\\\\\\\\\\"');
                        rawcmd = rawcmd.replace(/!@#!SMEE_3_!@#!/g, '\\\\\\"');
                        rawcmd = rawcmd.trim();
                        templist[0] = scmd;
                        templist[1] = rawcmd;
                        typemap.push(templist);
                    }
                };
                console.log('initials: ' + initials);
                for (inti = 0; inti < initials.length; inti++) {
                    totalcmd += '{id:commandblock_minecart,Command:"' + initials[inti] + '"},' // adds final init product to totalcmd
                }
                var yup = -4;
                console.log('final cmds: ')
                console.log(typemap);
                //alert((typemap[yval])[0] + ' ' + (typemap[yval])[1]);
                for (var yval = 0; yval < typemap.length; yval++) {
                    yup++;
                    if ((typemap[yval])[0] == '++z++') {
                        zspan++;
                        yup = -4;
                        continue;
                    }
                    totalcmd += '{id:commandblock_minecart,Command:"setblock ~-2 ~' + yup + ' ~'+ zspan + ' ';
                    if ((typemap[yval])[0] == 'r') {
                        totalcmd += 'repeating_command_block 1 0 ';
                    } else if ((typemap[yval])[0] == 'c') {
                        totalcmd += 'chain_command_block 1 0 ';
                    } else if ((typemap[yval])[0] == 'i') {
                        totalcmd += 'command_block 1 0 ';
                    } else if ((typemap[yval])[0] == 'rc') {
                        totalcmd += 'repeating_command_block 9 0 ';
                    } else if ((typemap[yval])[0] == 'cc') {
                        totalcmd += 'chain_command_block 9 0 ';
                    } else if ((typemap[yval])[0] == 'ic') {
                        totalcmd += 'command_block 9 0 ';
                    };
                    if ((typemap[yval])[0] != "i") {
                        totalcmd += '{auto:1,Command:\\"'
                    } else {
                        totalcmd += '{auto:0,Command:\\"'
                    };
                    totalcmd += (typemap[yval])[1];
                    totalcmd += '\\"}"},';
                };
                totalcmd += '{id:commandblock_minecart,Command:"setblock ~ ~ ~1 command_block 1 0 {Command:\\"fill ~ ~-3 ~-1 ~ ~ ~ air\\"}"},{id:commandblock_minecart,Command:"setblock ~ ~-1 ~1 redstone_block",auto:1},{id:commandblock_minecart,Command:"minecraft:kill @e[type=commandblock_minecart,r=1]"}]}]}]}'
                
                $(".scorearea").html(totalcmd); // finished product
            }
        </script>



    <div class="container" style="margin-top: 50px; width: 100%;">
            <div class="card">
              <div class="card-stacked">
                <div class="card-content">
                        <h5 class="center-align">Output</h5>
                        <div class="row">
                            <form class="col s12">
                                <div class="row">
                                    <div class="input-field col s12">
                                      <textarea class="scorearea" id="scorearea" rows="25" cols="20" style="height:100%;" class="materialize-textarea" placeholder="Stuff will appear here." readonly></textarea>
                                    </div>
                                    <div class="center-align">
                                      <a class="waves-effect waves-light btn btn-large green" style="width: calc(70% + 32px);" onclick="copyToClipboard('scorearea')">Copy</a>
                                    </div>
                                </div>
                            </form>
                        </div>     
                     </div>
                 </div>
            </div>
    </div>
</body>
</html>